<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç€è¦½å™¨å…¼å®¹æ€§æ¸¬è©¦ - Todo List</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }

        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .test-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s;
        }

        .test-button:hover {
            background: #218838;
        }

        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .result-container {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
        }

        .result-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .score-display {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }

        .score-high { color: #28a745; }
        .score-medium { color: #ffc107; }
        .score-low { color: #dc3545; }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .feature-item {
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }

        .feature-supported {
            background: #d4edda;
            color: #155724;
        }

        .feature-not-supported {
            background: #f8d7da;
            color: #721c24;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <header class="test-header">
            <h1>ğŸŒ ç€è¦½å™¨å…¼å®¹æ€§æ¸¬è©¦</h1>
            <p>æª¢æ¸¬æ‚¨çš„ç€è¦½å™¨å° Todo List æ‡‰ç”¨ç¨‹å¼çš„æ”¯æ´ç¨‹åº¦</p>
        </header>

        <main>
            <section class="test-section">
                <h2>ğŸš€ é–‹å§‹æ¸¬è©¦</h2>
                <p>é»æ“Šä¸‹é¢çš„æŒ‰éˆ•é–‹å§‹å®Œæ•´çš„ç€è¦½å™¨å…¼å®¹æ€§æ¸¬è©¦ï¼š</p>
                <button id="runTestBtn" class="test-button">åŸ·è¡Œå®Œæ•´æ¸¬è©¦</button>
                <button id="quickTestBtn" class="test-button">å¿«é€Ÿæª¢æŸ¥</button>
                <div id="loadingIndicator" class="loading" style="display: none;">
                    æ¸¬è©¦é€²è¡Œä¸­
                </div>
            </section>

            <section id="resultsSection" class="test-section" style="display: none;">
                <h2>ğŸ“Š æ¸¬è©¦çµæœ</h2>
                <div id="scoreDisplay" class="score-display"></div>
                <div id="browserInfo" class="result-container result-info"></div>

                <h3>ğŸ”§ åŠŸèƒ½æ”¯æ´æª¢æŸ¥</h3>
                <div id="featuresResult" class="feature-grid"></div>

                <h3>ğŸ¨ CSS æ”¯æ´æª¢æŸ¥</h3>
                <div id="cssResult" class="feature-grid"></div>

                <h3>â™¿ ç„¡éšœç¤™åŠŸèƒ½æ”¯æ´</h3>
                <div id="accessibilityResult" class="feature-grid"></div>

                <h3>âš¡ æ€§èƒ½æ¸¬è©¦</h3>
                <div id="performanceResult" class="result-container result-info"></div>

                <h3>ğŸ’¡ æ”¹é€²å»ºè­°</h3>
                <div id="recommendationsResult" class="result-container result-info"></div>
            </section>

            <section class="test-section">
                <h2>ğŸ” ç€è¦½å™¨æ”¯æ´çŸ©é™£</h2>
                <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                    <thead>
                        <tr style="background: #f0f0f0;">
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">ç€è¦½å™¨</th>
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">æœ€ä½ç‰ˆæœ¬</th>
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">æ¨è–¦ç‰ˆæœ¬</th>
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">æ”¯æ´ç‹€æ…‹</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 12px;">Chrome</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">90+</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">æœ€æ–°ç‰ˆæœ¬</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center; color: #28a745;">âœ… å®Œå…¨æ”¯æ´</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 12px;">Firefox</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">88+</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">æœ€æ–°ç‰ˆæœ¬</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center; color: #28a745;">âœ… å®Œå…¨æ”¯æ´</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 12px;">Safari</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">14+</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">æœ€æ–°ç‰ˆæœ¬</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center; color: #ffc107;">âš ï¸ éƒ¨åˆ†åŠŸèƒ½</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 12px;">Edge</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">90+</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">æœ€æ–°ç‰ˆæœ¬</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center; color: #28a745;">âœ… å®Œå…¨æ”¯æ´</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section class="test-section">
                <h2>ğŸ“± è¡Œå‹•è£ç½®æ”¯æ´</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div>
                        <h4>iOS Safari</h4>
                        <ul>
                            <li>iOS 14+ åŸºæœ¬æ”¯æ´</li>
                            <li>iOS 15+ å®Œæ•´æ”¯æ´</li>
                            <li>å»ºè­°ä½¿ç”¨ iOS 15 æˆ–æ›´æ–°ç‰ˆæœ¬</li>
                        </ul>
                    </div>
                    <div>
                        <h4>Android Chrome</h4>
                        <ul>
                            <li>Android 10+ åŸºæœ¬æ”¯æ´</li>
                            <li>Android 12+ å®Œæ•´æ”¯æ´</li>
                            <li>å»ºè­°ä½¿ç”¨ Android 12 æˆ–æ›´æ–°ç‰ˆæœ¬</li>
                        </ul>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="tests/browser-compatibility-test.js"></script>
    <script>
        // DOM å…ƒç´ 
        const runTestBtn = document.getElementById('runTestBtn');
        const quickTestBtn = document.getElementById('quickTestBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const resultsSection = document.getElementById('resultsSection');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const browserInfo = document.getElementById('browserInfo');
        const featuresResult = document.getElementById('featuresResult');
        const cssResult = document.getElementById('cssResult');
        const accessibilityResult = document.getElementById('accessibilityResult');
        const performanceResult = document.getElementById('performanceResult');
        const recommendationsResult = document.getElementById('recommendationsResult');

        // å‰µå»ºæ¸¬è©¦å¯¦ä¾‹
        const compatibilityTest = new BrowserCompatibilityTest();

        // äº‹ä»¶ç›£è½å™¨
        runTestBtn.addEventListener('click', runFullTest);
        quickTestBtn.addEventListener('click', runQuickTest);

        /**
         * åŸ·è¡Œå®Œæ•´æ¸¬è©¦
         */
        async function runFullTest() {
            showLoading(true);
            hideResults();

            try {
                console.log('é–‹å§‹åŸ·è¡Œå®Œæ•´ç€è¦½å™¨å…¼å®¹æ€§æ¸¬è©¦...');
                const results = await compatibilityTest.runFullTest();
                displayResults(results);
                console.log('æ¸¬è©¦å®Œæˆ:', results);
            } catch (error) {
                console.error('æ¸¬è©¦åŸ·è¡ŒéŒ¯èª¤:', error);
                displayError('æ¸¬è©¦åŸ·è¡Œå¤±æ•—: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        /**
         * åŸ·è¡Œå¿«é€Ÿæ¸¬è©¦
         */
        async function runQuickTest() {
            showLoading(true);
            hideResults();

            try {
                console.log('é–‹å§‹åŸ·è¡Œå¿«é€Ÿå…¼å®¹æ€§æª¢æŸ¥...');

                // åªæª¢æŸ¥åŸºæœ¬åŠŸèƒ½ï¼Œä¸åŸ·è¡Œæ€§èƒ½æ¸¬è©¦
                const browserInfo = BrowserDetector.getBrowserInfo();
                const features = FeatureDetector.checkBasicAPIs();
                const css = FeatureDetector.checkCSSFeatures();
                const accessibility = FeatureDetector.checkAccessibilityFeatures();

                const quickResults = {
                    browser: { ...browserInfo, version: BrowserDetector.getBrowserVersion() },
                    features,
                    css,
                    accessibility,
                    performance: null
                };

                displayQuickResults(quickResults);
                console.log('å¿«é€Ÿæª¢æŸ¥å®Œæˆ:', quickResults);
            } catch (error) {
                console.error('å¿«é€Ÿæª¢æŸ¥éŒ¯èª¤:', error);
                displayError('å¿«é€Ÿæª¢æŸ¥å¤±æ•—: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        /**
         * å®‰å…¨åœ°å‰µå»ºå…ƒç´ ä¸¦è¨­ç½®æ–‡æœ¬å…§å®¹
         */
        function safeCreateElement(tag, textContent, className) {
            const element = document.createElement(tag);
            if (textContent) {
                element.textContent = textContent;
            }
            if (className) {
                element.className = className;
            }
            return element;
        }

        /**
         * å®‰å…¨åœ°æ¸…é™¤å…ƒç´ å…§å®¹
         */
        function safeClearElement(element) {
            while (element.firstChild) {
                element.removeChild(element.firstChild);
            }
        }

        /**
         * é¡¯ç¤ºå®Œæ•´æ¸¬è©¦çµæœ
         */
        function displayResults(results) {
            const summary = compatibilityTest.generateSummary();

            // å®‰å…¨åœ°é¡¯ç¤ºåˆ†æ•¸
            safeClearElement(scoreDisplay);
            const scoreClass = summary.overallScore >= 90 ? 'score-high' :
                             summary.overallScore >= 70 ? 'score-medium' : 'score-low';

            const scoreMain = safeCreateElement('div', `ç¸½é«”è©•åˆ†: ${summary.overallScore}%`, scoreClass);
            scoreDisplay.appendChild(scoreMain);

            const scoreDetails = safeCreateElement('div',
                `åŠŸèƒ½æ”¯æ´: ${summary.featureSupport.score}% | CSSæ”¯æ´: ${summary.cssSupport.score}% | ç„¡éšœç¤™: ${summary.accessibilitySupport.score}%`,
                ''
            );
            scoreDetails.style.fontSize = '14px';
            scoreDetails.style.color = '#666';
            scoreDetails.style.marginTop = '10px';
            scoreDisplay.appendChild(scoreDetails);

            // å®‰å…¨åœ°é¡¯ç¤ºç€è¦½å™¨è³‡è¨Š
            browserInfo.textContent = `ç€è¦½å™¨: ${summary.browser} | å¹³å°: ${summary.platform} | è¨­å‚™: ${summary.isMobile ? 'è¡Œå‹•è£ç½®' : 'æ¡Œé¢è£ç½®'}`;

            // é¡¯ç¤ºåŠŸèƒ½æ”¯æ´
            displayFeatureGrid(featuresResult, results.features);

            // é¡¯ç¤º CSS æ”¯æ´
            displayFeatureGrid(cssResult, results.css);

            // é¡¯ç¤ºç„¡éšœç¤™æ”¯æ´
            displayFeatureGrid(accessibilityResult, results.accessibility);

            // é¡¯ç¤ºæ€§èƒ½çµæœ
            displayPerformanceResults(results.performance);

            // é¡¯ç¤ºå»ºè­°
            displayRecommendations(compatibilityTest.generateRecommendations());

            showResults();
        }

        /**
         * é¡¯ç¤ºå¿«é€Ÿæ¸¬è©¦çµæœ
         */
        function displayQuickResults(results) {
            const featureCount = Object.values(results.features).filter(Boolean).length;
            const totalFeatures = Object.keys(results.features).length;
            const score = Math.round((featureCount / totalFeatures) * 100);

            safeClearElement(scoreDisplay);
            const scoreClass = score >= 90 ? 'score-high' : score >= 70 ? 'score-medium' : 'score-low';

            const scoreMain = safeCreateElement('div', `å…¼å®¹æ€§è©•åˆ†: ${score}%`, scoreClass);
            scoreDisplay.appendChild(scoreMain);

            const scoreDetails = safeCreateElement('div', `åŠŸèƒ½æ”¯æ´: ${featureCount}/${totalFeatures}`, '');
            scoreDetails.style.fontSize = '14px';
            scoreDetails.style.color = '#666';
            scoreDetails.style.marginTop = '10px';
            scoreDisplay.appendChild(scoreDetails);

            // å®‰å…¨åœ°é¡¯ç¤ºç€è¦½å™¨è³‡è¨Š
            const browserName = results.browser.isChrome ? 'Chrome' :
                               results.browser.isFirefox ? 'Firefox' :
                               results.browser.isSafari ? 'Safari' :
                               results.browser.isEdge ? 'Edge' : 'Unknown';
            browserInfo.textContent = `ç€è¦½å™¨: ${browserName} ${results.browser.version} | å¹³å°: ${results.browser.platform}`;

            // é¡¯ç¤ºé—œéµåŠŸèƒ½æ”¯æ´
            displayFeatureGrid(featuresResult, results.features);
            displayFeatureGrid(cssResult, results.css);

            showResults();
        }

        /**
         * é¡¯ç¤ºåŠŸèƒ½ç¶²æ ¼
         */
        function displayFeatureGrid(container, features) {
            safeClearElement(container);

            for (const [feature, supported] of Object.entries(features)) {
                const item = safeCreateElement(
                    'div',
                    `${feature}: ${supported ? 'âœ…' : 'âŒ'}`,
                    `feature-item ${supported ? 'feature-supported' : 'feature-not-supported'}`
                );
                container.appendChild(item);
            }
        }

        /**
         * é¡¯ç¤ºæ€§èƒ½çµæœ
         */
        function displayPerformanceResults(performance) {
            if (!performance) {
                performanceResult.textContent = 'æœªåŸ·è¡Œæ€§èƒ½æ¸¬è©¦';
                return;
            }

            let text = '';

            if (performance.localStorage && !performance.localStorage.error) {
                text += 'localStorage æ€§èƒ½æ¸¬è©¦:\n';
                for (const [size, data] of Object.entries(performance.localStorage)) {
                    text += `  ${size} å¯«å…¥: ${data.writeTime.average.toFixed(3)}ms, è®€å–: ${data.readTime.average.toFixed(3)}ms\n`;
                }
            }

            if (performance.dom) {
                text += 'DOM æ“ä½œæ€§èƒ½:\n';
                text += `  å…ƒç´ å‰µå»º: ${performance.dom.createElement.average.toFixed(3)}ms\n`;
                text += `  æŸ¥è©¢æ“ä½œ: ${performance.dom.querySelector.average.toFixed(3)}ms\n`;
            }

            performanceResult.textContent = text || 'æ€§èƒ½æ¸¬è©¦æ•¸æ“šä¸å¯ç”¨';
        }

        /**
         * é¡¯ç¤ºå»ºè­°
         */
        function displayRecommendations(recommendations) {
            safeClearElement(recommendationsResult);

            if (recommendations.length === 0) {
                recommendationsResult.textContent = 'ğŸ‰ å¤ªæ£’äº†ï¼æ²’æœ‰ç™¼ç¾å…¼å®¹æ€§å•é¡Œã€‚';
                return;
            }

            let text = 'ç™¼ç¾ä»¥ä¸‹å…¼å®¹æ€§å•é¡Œå’Œå»ºè­°:\n\n';

            recommendations.forEach(rec => {
                const icon = rec.type === 'critical' ? 'ğŸš¨' :
                           rec.type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
                text += `${icon} ${rec.issue}\n`;
                text += `   è§£æ±ºæ–¹æ¡ˆ: ${rec.solution}\n\n`;
            });

            recommendationsResult.textContent = text;
        }

        /**
         * é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
         */
        function displayError(message) {
            safeClearElement(scoreDisplay);
            const errorElement = safeCreateElement('div', 'æ¸¬è©¦å¤±æ•—', 'score-low');
            scoreDisplay.appendChild(errorElement);
            browserInfo.textContent = message;
            showResults();
        }

        /**
         * é¡¯ç¤º/éš±è—è¼‰å…¥æŒ‡ç¤ºå™¨
         */
        function showLoading(show) {
            loadingIndicator.style.display = show ? 'block' : 'none';
            runTestBtn.disabled = show;
            quickTestBtn.disabled = show;
        }

        /**
         * é¡¯ç¤º/éš±è—çµæœå€åŸŸ
         */
        function showResults() {
            resultsSection.style.display = 'block';
        }

        function hideResults() {
            resultsSection.style.display = 'none';
        }

        // å¦‚æœå·²ç¶“å­˜åœ¨æ¸¬è©¦çµæœï¼Œè‡ªå‹•é¡¯ç¤º
        try {
            const savedReport = localStorage.getItem('browserCompatibilityReport');
            if (savedReport) {
                const report = JSON.parse(savedReport);
                console.log('æ‰¾åˆ°ä¿å­˜çš„æ¸¬è©¦å ±å‘Š');
                // å¯ä»¥é¸æ“‡è‡ªå‹•é¡¯ç¤ºä¹‹å‰çš„çµæœ
            }
        } catch (e) {
            console.warn('ç„¡æ³•è®€å–ä¿å­˜çš„æ¸¬è©¦å ±å‘Š:', e);
        }
    </script>
</body>
</html>