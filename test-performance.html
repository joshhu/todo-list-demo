<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€§èƒ½æ¸¬è©¦ - Todo List</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        .performance-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }

        .performance-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 10px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .control-panel {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .test-button:hover {
            background: #0056b3;
        }

        .test-button.success {
            background: #28a745;
        }

        .test-button.warning {
            background: #ffc107;
            color: #000;
        }

        .test-button.danger {
            background: #dc3545;
        }

        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .metric-card.good {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .metric-card.needs-improvement {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
        }

        .metric-card.poor {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .metric-value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .metric-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .metric-unit {
            font-size: 18px;
            opacity: 0.8;
        }

        .score-display {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            margin: 30px 0;
            padding: 30px;
            border-radius: 15px;
            color: white;
        }

        .score-high {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .score-medium {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }

        .score-low {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .recommendations {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .recommendation-item {
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .recommendation-item.high {
            border-left-color: #dc3545;
        }

        .recommendation-item.medium {
            border-left-color: #ffc107;
        }

        .recommendation-item.low {
            border-left-color: #28a745;
        }

        .recommendation-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .recommendation-description {
            color: #666;
            margin-bottom: 10px;
        }

        .recommendation-actions {
            margin-top: 10px;
        }

        .recommendation-actions li {
            margin: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .recommendation-actions li::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            color: #007bff;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #0056b3);
            transition: width 0.3s ease;
        }

        .tab-container {
            margin-top: 20px;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ddd;
        }

        .tab-button {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab-button:hover {
            background: #f8f9fa;
        }

        .tab-button.active {
            border-bottom-color: #007bff;
            color: #007bff;
        }

        .tab-content {
            padding: 20px 0;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="performance-container">
        <header class="performance-header">
            <h1>âš¡ æ€§èƒ½æ¸¬è©¦å·¥å…·</h1>
            <p>æª¢æ¸¬å’Œå„ªåŒ– Todo List æ‡‰ç”¨ç¨‹å¼çš„æ€§èƒ½è¡¨ç¾</p>
        </header>

        <main>
            <section class="test-section">
                <h2>ğŸš€ é–‹å§‹æ¸¬è©¦</h2>
                <div class="control-panel">
                    <button id="runPerformanceTest" class="test-button">åŸ·è¡Œæ€§èƒ½æ¸¬è©¦</button>
                    <button id="runLighthouseTest" class="test-button">åŸ·è¡Œ Lighthouse æ¸¬è©¦</button>
                    <button id="applyOptimizations" class="test-button">æ‡‰ç”¨æ€§èƒ½å„ªåŒ–</button>
                    <button id="clearCache" class="test-button">æ¸…ç†å¿«å–</button>
                    <button id="generateReport" class="test-button">ç”Ÿæˆæ€§èƒ½å ±å‘Š</button>
                </div>

                <div id="loadingIndicator" class="loading" style="display: none;">
                    æ­£åœ¨åŸ·è¡Œæ¸¬è©¦
                </div>

                <div id="progressContainer" style="display: none;">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                    </div>
                    <div id="progressText" style="text-align: center; margin-top: 10px;">0%</div>
                </div>
            </section>

            <section id="resultsSection" class="test-section" style="display: none;">
                <h2>ğŸ“Š æ¸¬è©¦çµæœ</h2>

                <div id="scoreDisplay" class="score-display"></div>

                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-button active" data-tab="vitals">æ ¸å¿ƒæŒ‡æ¨™</button>
                        <button class="tab-button" data-tab="navigation">å°èˆªæ€§èƒ½</button>
                        <button class="tab-button" data-tab="resources">è³‡æºåˆ†æ</button>
                        <button class="tab-button" data-tab="memory">è¨˜æ†¶é«”ä½¿ç”¨</button>
                    </div>

                    <div class="tab-content">
                        <div id="vitals" class="tab-pane active">
                            <div class="metrics-grid" id="vitalsMetrics"></div>
                        </div>
                        <div id="navigation" class="tab-pane">
                            <div class="metrics-grid" id="navigationMetrics"></div>
                        </div>
                        <div id="resources" class="tab-pane">
                            <div id="resourcesChart"></div>
                        </div>
                        <div id="memory" class="tab-pane">
                            <div id="memoryChart"></div>
                        </div>
                    </div>
                </div>

                <div class="recommendations">
                    <h3>ğŸ’¡ å„ªåŒ–å»ºè­°</h3>
                    <div id="recommendationsList"></div>
                </div>
            </section>

            <section class="test-section">
                <h2>ğŸ”§ æ€§èƒ½å„ªåŒ–ç‹€æ…‹</h2>
                <div id="optimizationsStatus"></div>
            </section>

            <section class="test-section">
                <h2>ğŸ“ˆ æ€§èƒ½åŸºæº–</h2>
                <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                    <thead>
                        <tr style="background: #f0f0f0;">
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">æŒ‡æ¨™</th>
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">ç›®æ¨™å€¼</th>
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">ç•¶å‰å€¼</th>
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">ç‹€æ…‹</th>
                        </tr>
                    </thead>
                    <tbody id="benchmarkTable">
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 12px;">LCP (æœ€å¤§å…§å®¹ç¹ªè£½)</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">&lt; 2.5s</td>
                            <td id="lcpCurrent" style="border: 1px solid #ddd; padding: 12px; text-align: center;">-</td>
                            <td id="lcpStatus" style="border: 1px solid #ddd; padding: 12px; text-align: center;">-</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 12px;">FID (é¦–æ¬¡è¼¸å…¥å»¶é²)</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">&lt; 100ms</td>
                            <td id="fidCurrent" style="border: 1px solid #ddd; padding: 12px; text-align: center;">-</td>
                            <td id="fidStatus" style="border: 1px solid #ddd; padding: 12px; text-align: center;">-</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 12px;">CLS (ç´¯è¨ˆä½ˆå±€åç§»)</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">&lt; 0.1</td>
                            <td id="clsCurrent" style="border: 1px solid #ddd; padding: 12px; text-align: center;">-</td>
                            <td id="clsStatus" style="border: 1px solid #ddd; padding: 12px; text-align: center;">-</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 12px;">TTFB (é¦–å­—ç¯€æ™‚é–“)</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">&lt; 800ms</td>
                            <td id="ttfbCurrent" style="border: 1px solid #ddd; padding: 12px; text-align: center;">-</td>
                            <td id="ttfbStatus" style="border: 1px solid #ddd; padding: 12px; text-align: center;">-</td>
                        </tr>
                    </tbody>
                </table>
            </section>
        </main>
    </div>

    <script src="js/modules/performance.js"></script>
    <script>
        // DOM å…ƒç´ 
        const runPerformanceTest = document.getElementById('runPerformanceTest');
        const runLighthouseTest = document.getElementById('runLighthouseTest');
        const applyOptimizations = document.getElementById('applyOptimizations');
        const clearCache = document.getElementById('clearCache');
        const generateReport = document.getElementById('generateReport');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const resultsSection = document.getElementById('resultsSection');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const recommendationsList = document.getElementById('recommendationsList');
        const optimizationsStatus = document.getElementById('optimizationsStatus');

        // å¯¦ä¾‹
        let performanceMonitor = null;
        let performanceOptimizer = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            if (window.PerformanceMonitor && window.PerformanceOptimizer) {
                performanceMonitor = new window.PerformanceMonitor();
                performanceOptimizer = new window.PerformanceOptimizer();
            }

            setupEventListeners();
            checkOptimizationsStatus();
            setupTabs();
        });

        /**
         * è¨­ç½®äº‹ä»¶ç›£è½å™¨
         */
        function setupEventListeners() {
            runPerformanceTest.addEventListener('click', executePerformanceTest);
            runLighthouseTest.addEventListener('click', executeLighthouseTest);
            applyOptimizations.addEventListener('click', applyPerformanceOptimizations);
            clearCache.addEventListener('click', clearApplicationCache);
            generateReport.addEventListener('click', generatePerformanceReport);
        }

        /**
         * è¨­ç½®æ¨™ç±¤é 
         */
        function setupTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabPanes = document.querySelectorAll('.tab-pane');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;

                    // ç§»é™¤æ‰€æœ‰æ´»å‹•ç‹€æ…‹
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabPanes.forEach(pane => pane.classList.remove('active'));

                    // æ·»åŠ æ´»å‹•ç‹€æ…‹
                    button.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });
        }

        /**
         * å®‰å…¨åœ°å‰µå»ºå…ƒç´ ä¸¦è¨­ç½®æ–‡æœ¬å…§å®¹
         */
        function safeCreateElement(tag, textContent, className) {
            const element = document.createElement(tag);
            if (textContent) {
                element.textContent = textContent;
            }
            if (className) {
                element.className = className;
            }
            return element;
        }

        /**
         * å®‰å…¨åœ°æ¸…é™¤å…ƒç´ å…§å®¹
         */
        function safeClearElement(element) {
            while (element.firstChild) {
                element.removeChild(element.firstChild);
            }
        }

        /**
         * åŸ·è¡Œæ€§èƒ½æ¸¬è©¦
         */
        async function executePerformanceTest() {
            showLoading(true);
            updateProgress(0, 'åˆå§‹åŒ–æ€§èƒ½ç›£æ§...');

            try {
                // é‡æ–°åˆå§‹åŒ–ä»¥ç²å–æœ€æ–°æ•¸æ“š
                if (window.PerformanceMonitor) {
                    performanceMonitor = new window.PerformanceMonitor();
                }

                updateProgress(20, 'ç­‰å¾…é é¢è¼‰å…¥å®Œæˆ...');
                await waitForPageLoad();

                updateProgress(40, 'æ”¶é›†æ€§èƒ½æŒ‡æ¨™...');
                await collectMetrics();

                updateProgress(60, 'åˆ†ææ¸¬è©¦çµæœ...');
                const report = performanceMonitor ? performanceMonitor.getPerformanceReport() : generateMockReport();

                updateProgress(80, 'ç”Ÿæˆè¦–è¦ºåŒ–åœ–è¡¨...');
                displayResults(report);

                updateProgress(100, 'æ¸¬è©¦å®Œæˆ');
                hideLoading();

            } catch (error) {
                console.error('æ€§èƒ½æ¸¬è©¦å¤±æ•—:', error);
                showError('æ€§èƒ½æ¸¬è©¦åŸ·è¡Œå¤±æ•—: ' + error.message);
                hideLoading();
            }
        }

        /**
         * åŸ·è¡Œ Lighthouse æ¸¬è©¦
         */
        async function executeLighthouseTest() {
            showLoading(true);
            updateProgress(0, 'å•Ÿå‹• Lighthouse æ¸¬è©¦...');

            try {
                // æª¢æŸ¥æ˜¯å¦æ”¯æ´ Lighthouse API
                if (!window.lighthouse) {
                    // å¦‚æœæ²’æœ‰ Lighthouseï¼Œæä¾›æ‰‹å‹•æ¸¬è©¦æŒ‡å°
                    showLighthouseInstructions();
                    return;
                }

                updateProgress(50, 'åŸ·è¡Œ Lighthouse åˆ†æ...');

                // åŸ·è¡Œ Lighthouse æ¸¬è©¦
                const lighthouseReport = await runLighthouse();

                updateProgress(100, 'Lighthouse æ¸¬è©¦å®Œæˆ');
                displayLighthouseResults(lighthouseReport);
                hideLoading();

            } catch (error) {
                console.error('Lighthouse æ¸¬è©¦å¤±æ•—:', error);
                showLighthouseInstructions();
                hideLoading();
            }
        }

        /**
         * é¡¯ç¤º Lighthouse æ¸¬è©¦æŒ‡å°
         */
        function showLighthouseInstructions() {
            const instructions = safeCreateElement('div', '', 'test-section');

            const title = safeCreateElement('h3', 'ğŸ” Lighthouse æ¸¬è©¦æŒ‡å°');
            instructions.appendChild(title);

            const intro = safeCreateElement('p', 'è¦åŸ·è¡Œå®Œæ•´çš„ Lighthouse æ¸¬è©¦ï¼Œè«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿï¼š');
            instructions.appendChild(intro);

            const stepsList = safeCreateElement('ol');
            stepsList.style.lineHeight = '1.8';

            const steps = [
                'æ‰“é–‹ Chrome é–‹ç™¼è€…å·¥å…· (F12)',
                'åˆ‡æ›åˆ° "Lighthouse" æ¨™ç±¤',
                'é¸æ“‡æ¸¬è©¦é¡åˆ¥ï¼ˆå»ºè­°é¸æ“‡æ€§èƒ½ã€ç„¡éšœç¤™ã€æœ€ä½³å¯¦è¸ï¼‰',
                'é»æ“Š "ç”Ÿæˆå ±å‘Š" æŒ‰éˆ•',
                'ç­‰å¾…æ¸¬è©¦å®Œæˆä¸¦æŸ¥çœ‹çµæœ'
            ];

            steps.forEach(step => {
                const li = safeCreateElement('li', step);
                stepsList.appendChild(li);
            });
            instructions.appendChild(stepsList);

            const targetNote = safeCreateElement('p', 'ç›®æ¨™åˆ†æ•¸ï¼šæ‰€æœ‰é¡åˆ¥éƒ½æ‡‰é”åˆ° 90 åˆ†ä»¥ä¸Š');
            targetNote.style.fontWeight = 'bold';
            instructions.appendChild(targetNote);

            const closeButton = safeCreateElement('button', 'é—œé–‰æŒ‡å°', 'test-button');
            closeButton.addEventListener('click', () => instructions.remove());
            instructions.appendChild(closeButton);

            document.querySelector('main').appendChild(instructions);
            hideLoading();
        }

        /**
         * æ‡‰ç”¨æ€§èƒ½å„ªåŒ–
         */
        async function applyPerformanceOptimizations() {
            showLoading(true);
            updateProgress(0, 'æ‡‰ç”¨æ€§èƒ½å„ªåŒ–...');

            try {
                if (!performanceOptimizer) {
                    throw new Error('æ€§èƒ½å„ªåŒ–å™¨æœªåˆå§‹åŒ–');
                }

                const optimizations = await performanceOptimizer.applyAllOptimizations();

                updateProgress(100, 'å„ªåŒ–å®Œæˆ');
                hideLoading();

                showOptimizationsSuccess(optimizations);
                checkOptimizationsStatus();

            } catch (error) {
                console.error('æ‡‰ç”¨å„ªåŒ–å¤±æ•—:', error);
                showError('æ‡‰ç”¨æ€§èƒ½å„ªåŒ–å¤±æ•—: ' + error.message);
                hideLoading();
            }
        }

        /**
         * æ¸…ç†æ‡‰ç”¨å¿«å–
         */
        async function clearApplicationCache() {
            showLoading(true);
            updateProgress(0, 'æ¸…ç†å¿«å–...');

            try {
                // æ¸…ç†ç€è¦½å™¨å¿«å–
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(
                        cacheNames.map(cacheName => caches.delete(cacheName))
                    );
                }

                // æ¸…ç† localStorage
                localStorage.clear();

                // é€šçŸ¥ Service Worker æ¸…ç†å¿«å–
                if ('serviceWorker' in navigator) {
                    const registration = await navigator.serviceWorker.ready;
                    if (registration.active) {
                        registration.active.postMessage({ type: 'CLEAR_CACHE' });
                    }
                }

                updateProgress(100, 'å¿«å–æ¸…ç†å®Œæˆ');
                hideLoading();

                showSuccess('æ‰€æœ‰å¿«å–å·²æ¸…ç†å®Œæˆ');

            } catch (error) {
                console.error('æ¸…ç†å¿«å–å¤±æ•—:', error);
                showError('æ¸…ç†å¿«å–å¤±æ•—: ' + error.message);
                hideLoading();
            }
        }

        /**
         * ç”Ÿæˆæ€§èƒ½å ±å‘Š
         */
        async function generatePerformanceReport() {
            if (!performanceMonitor) {
                showError('è«‹å…ˆåŸ·è¡Œæ€§èƒ½æ¸¬è©¦');
                return;
            }

            const report = performanceMonitor.getPerformanceReport();

            // å‰µå»ºå¯ä¸‹è¼‰çš„å ±å‘Šæ–‡ä»¶
            const reportData = {
                timestamp: new Date().toISOString(),
                url: window.location.href,
                userAgent: navigator.userAgent,
                ...report
            };

            const blob = new Blob([JSON.stringify(reportData, null, 2)], {
                type: 'application/json'
            });

            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `performance-report-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showSuccess('æ€§èƒ½å ±å‘Šå·²ä¸‹è¼‰');
        }

        /**
         * ç­‰å¾…é é¢è¼‰å…¥å®Œæˆ
         */
        function waitForPageLoad() {
            return new Promise(resolve => {
                if (document.readyState === 'complete') {
                    resolve();
                } else {
                    window.addEventListener('load', resolve, { once: true });
                }
            });
        }

        /**
         * æ”¶é›†æ€§èƒ½æŒ‡æ¨™
         */
        async function collectMetrics() {
            // ç­‰å¾…ä¸€æ®µæ™‚é–“è®“ç€è¦½å™¨æ”¶é›†æŒ‡æ¨™
            await new Promise(resolve => setTimeout(resolve, 2000));
        }

        /**
         * ç”Ÿæˆæ¨¡æ“¬å ±å‘Šï¼ˆç”¨æ–¼æ¸¬è©¦ï¼‰
         */
        function generateMockReport() {
            return {
                score: 85,
                vitals: {
                    LCP: 2100,
                    FID: 45,
                    CLS: 0.08,
                    FCP: 1200
                },
                navigation: {
                    dns: 12,
                    tcp: 45,
                    ttfb: 180,
                    download: 230,
                    domParse: 150,
                    totalTime: 1800
                },
                resources: {
                    script: { count: 5, totalSize: 125000, totalTime: 450 },
                    stylesheet: { count: 3, totalSize: 45000, totalTime: 120 },
                    image: { count: 8, totalSize: 280000, totalTime: 680 }
                },
                memory: {
                    used: 25000000,
                    total: 50000000,
                    limit: 2000000000
                },
                recommendations: [
                    {
                        metric: 'LCP',
                        priority: 'medium',
                        title: 'å„ªåŒ–æœ€å¤§å…§å®¹ç¹ªè£½æ™‚é–“',
                        description: 'ç•¶å‰ LCP ç‚º 2100msï¼Œå»ºè­°å„ªåŒ–åˆ° 2500ms ä»¥ä¸‹',
                        actions: [
                            'ä½¿ç”¨ç¾ä»£åœ–ç‰‡æ ¼å¼ï¼ˆWebPã€AVIFï¼‰',
                            'å¯¦ç¾åœ–ç‰‡æ‡¶åŠ è¼‰',
                            'å„ªåŒ–ä¼ºæœå™¨éŸ¿æ‡‰æ™‚é–“'
                        ]
                    }
                ]
            };
        }

        /**
         * é¡¯ç¤ºæ¸¬è©¦çµæœ
         */
        function displayResults(report) {
            // é¡¯ç¤ºç¸½åˆ†
            displayScore(report.score);

            // é¡¯ç¤ºæ ¸å¿ƒæŒ‡æ¨™
            displayVitals(report.vitals);

            // é¡¯ç¤ºå°èˆªæŒ‡æ¨™
            displayNavigationMetrics(report.navigation);

            // é¡¯ç¤ºè³‡æºæŒ‡æ¨™
            displayResourceMetrics(report.resources);

            // é¡¯ç¤ºè¨˜æ†¶é«”æŒ‡æ¨™
            displayMemoryMetrics(report.memory);

            // é¡¯ç¤ºå»ºè­°
            displayRecommendations(report.recommendations);

            // æ›´æ–°åŸºæº–è¡¨
            updateBenchmarkTable(report.vitals);

            // é¡¯ç¤ºçµæœå€åŸŸ
            resultsSection.style.display = 'block';
        }

        /**
         * é¡¯ç¤ºç¸½åˆ†
         */
        function displayScore(score) {
            let scoreClass = 'score-low';
            if (score >= 90) {
                scoreClass = 'score-high';
            } else if (score >= 70) {
                scoreClass = 'score-medium';
            }

            scoreDisplay.className = `score-display ${scoreClass}`;
            safeClearElement(scoreDisplay);

            const scoreMain = safeCreateElement('div', `æ€§èƒ½ç¸½åˆ†: ${score}/100`);
            scoreDisplay.appendChild(scoreMain);

            const scoreDesc = safeCreateElement('div', getScoreDescription(score));
            scoreDesc.style.fontSize = '18px';
            scoreDesc.style.marginTop = '10px';
            scoreDesc.style.opacity = '0.9';
            scoreDisplay.appendChild(scoreDesc);
        }

        /**
         * ç²å–åˆ†æ•¸æè¿°
         */
        function getScoreDescription(score) {
            if (score >= 90) return 'å„ªç§€ ğŸŒŸ';
            if (score >= 70) return 'è‰¯å¥½ ğŸ‘';
            if (score >= 50) return 'ä¸€èˆ¬ âš ï¸';
            return 'éœ€è¦æ”¹é€² ğŸ”§';
        }

        /**
         * é¡¯ç¤ºæ ¸å¿ƒæŒ‡æ¨™
         */
        function displayVitals(vitals) {
            const container = document.getElementById('vitalsMetrics');
            safeClearElement(container);

            const metrics = [
                { key: 'LCP', label: 'æœ€å¤§å…§å®¹ç¹ªè£½', unit: 'ms', threshold: 2500 },
                { key: 'FID', label: 'é¦–æ¬¡è¼¸å…¥å»¶é²', unit: 'ms', threshold: 100 },
                { key: 'CLS', label: 'ç´¯è¨ˆä½ˆå±€åç§»', unit: '', threshold: 0.1 },
                { key: 'FCP', label: 'é¦–æ¬¡å…§å®¹ç¹ªè£½', unit: 'ms', threshold: 1800 }
            ];

            metrics.forEach(metric => {
                const value = vitals[metric.key];
                if (value !== undefined) {
                    const status = getMetricStatus(value, metric.threshold);
                    const card = createMetricCard(metric.label, value, metric.unit, status);
                    container.appendChild(card);
                }
            });
        }

        /**
         * é¡¯ç¤ºå°èˆªæŒ‡æ¨™
         */
        function displayNavigationMetrics(navigation) {
            const container = document.getElementById('navigationMetrics');
            safeClearElement(container);

            if (!navigation) {
                container.appendChild(safeCreateElement('p', 'ç„¡å°èˆªæ•¸æ“š'));
                return;
            }

            const metrics = [
                { key: 'dns', label: 'DNS æŸ¥è©¢', unit: 'ms' },
                { key: 'tcp', label: 'TCP é€£æ¥', unit: 'ms' },
                { key: 'ttfb', label: 'é¦–å­—ç¯€æ™‚é–“', unit: 'ms' },
                { key: 'download', label: 'è³‡æºä¸‹è¼‰', unit: 'ms' },
                { key: 'domParse', label: 'DOM è§£æ', unit: 'ms' },
                { key: 'totalTime', label: 'ç¸½è¼‰å…¥æ™‚é–“', unit: 'ms' }
            ];

            metrics.forEach(metric => {
                const value = navigation[metric.key];
                if (value !== undefined) {
                    const threshold = metric.key === 'totalTime' ? 3000 : 1000;
                    const status = getMetricStatus(value, threshold);
                    const card = createMetricCard(metric.label, Math.round(value), metric.unit, status);
                    container.appendChild(card);
                }
            });
        }

        /**
         * é¡¯ç¤ºè³‡æºæŒ‡æ¨™
         */
        function displayResourceMetrics(resources) {
            const container = document.getElementById('resourcesChart');
            safeClearElement(container);

            if (!resources || Object.keys(resources).length === 0) {
                container.appendChild(safeCreateElement('p', 'ç„¡è³‡æºæ•¸æ“š'));
                return;
            }

            Object.entries(resources).forEach(([type, data]) => {
                const resourceDiv = safeCreateElement('div');
                resourceDiv.style.margin = '15px 0';
                resourceDiv.style.padding = '15px';
                resourceDiv.style.background = '#f8f9fa';
                resourceDiv.style.borderRadius = '8px';

                const title = safeCreateElement('h4', `${type.toUpperCase()} (${data.count} å€‹è³‡æº)`);
                resourceDiv.appendChild(title);

                const sizeInfo = safeCreateElement('div', `ç¸½å¤§å°: ${formatBytes(data.totalSize)}`);
                resourceDiv.appendChild(sizeInfo);

                const timeInfo = safeCreateElement('div', `ç¸½æ™‚é–“: ${Math.round(data.totalTime)}ms`);
                resourceDiv.appendChild(timeInfo);

                // æ·»åŠ é€²åº¦æ¢
                const progressContainer = safeCreateElement('div');
                progressContainer.style.marginTop = '10px';

                const progressBar = safeCreateElement('div');
                progressBar.style.background = '#e9ecef';
                progressBar.style.height = '20px';
                progressBar.style.borderRadius = '10px';
                progressBar.style.overflow = 'hidden';

                const progressFill = safeCreateElement('div');
                progressFill.style.background = '#007bff';
                progressFill.style.height = '100%';
                progressFill.style.width = `${Math.min(100, (data.totalTime / 1000) * 100)}%`;

                progressBar.appendChild(progressFill);
                progressContainer.appendChild(progressBar);
                resourceDiv.appendChild(progressContainer);

                container.appendChild(resourceDiv);
            });
        }

        /**
         * é¡¯ç¤ºè¨˜æ†¶é«”æŒ‡æ¨™
         */
        function displayMemoryMetrics(memory) {
            const container = document.getElementById('memoryChart');
            safeClearElement(container);

            if (!memory) {
                container.appendChild(safeCreateElement('p', 'ç€è¦½å™¨ä¸æ”¯æ´è¨˜æ†¶é«”ç›£æ§'));
                return;
            }

            const memoryDiv = safeCreateElement('div');
            memoryDiv.style.padding = '20px';
            memoryDiv.style.background = '#f8f9fa';
            memoryDiv.style.borderRadius = '8px';

            const title = safeCreateElement('h4', 'è¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³');
            memoryDiv.appendChild(title);

            const usedInfo = safeCreateElement('div', `å·²ä½¿ç”¨: ${formatBytes(memory.used)}`);
            memoryDiv.appendChild(usedInfo);

            const totalInfo = safeCreateElement('div', `ç¸½è¨ˆ: ${formatBytes(memory.total)}`);
            memoryDiv.appendChild(totalInfo);

            const limitInfo = safeCreateElement('div', `é™åˆ¶: ${formatBytes(memory.limit)}`);
            memoryDiv.appendChild(limitInfo);

            // æ·»åŠ é€²åº¦æ¢
            const progressContainer = safeCreateElement('div');
            progressContainer.style.marginTop = '15px';

            const progressBar = safeCreateElement('div');
            progressBar.style.background = '#e9ecef';
            progressBar.style.height = '30px';
            progressBar.style.borderRadius = '15px';
            progressBar.style.overflow = 'hidden';

            const progressFill = safeCreateElement('div');
            progressFill.style.background = getMemoryColor(memory.used / memory.total);
            progressFill.style.height = '100%';
            progressFill.style.width = `${(memory.used / memory.total) * 100}%`;
            progressFill.style.display = 'flex';
            progressFill.style.alignItems = 'center';
            progressFill.style.justifyContent = 'center';
            progressFill.style.color = 'white';
            progressFill.style.fontWeight = 'bold';
            progressFill.textContent = `${Math.round((memory.used / memory.total) * 100)}%`;

            progressBar.appendChild(progressFill);
            progressContainer.appendChild(progressBar);
            memoryDiv.appendChild(progressContainer);

            container.appendChild(memoryDiv);
        }

        /**
         * é¡¯ç¤ºå„ªåŒ–å»ºè­°
         */
        function displayRecommendations(recommendations) {
            safeClearElement(recommendationsList);

            if (!recommendations || recommendations.length === 0) {
                recommendationsList.appendChild(safeCreateElement('p', 'ğŸ‰ å¤ªæ£’äº†ï¼æ²’æœ‰ç™¼ç¾æ€§èƒ½å•é¡Œã€‚'));
                return;
            }

            recommendations.forEach(rec => {
                const item = safeCreateElement('div', '', `recommendation-item ${rec.priority}`);

                const title = safeCreateElement('div', `${rec.title} (${rec.priority})`, 'recommendation-title');
                item.appendChild(title);

                const description = safeCreateElement('div', rec.description, 'recommendation-description');
                item.appendChild(description);

                const actionsContainer = safeCreateElement('div', '', 'recommendation-actions');
                const actionsTitle = safeCreateElement('strong', 'å»ºè­°æªæ–½ï¼š');
                actionsContainer.appendChild(actionsTitle);

                const actionsList = safeCreateElement('ul');
                rec.actions.forEach(action => {
                    const li = safeCreateElement('li', action);
                    actionsList.appendChild(li);
                });
                actionsContainer.appendChild(actionsList);
                item.appendChild(actionsContainer);

                recommendationsList.appendChild(item);
            });
        }

        /**
         * æ›´æ–°åŸºæº–è¡¨
         */
        function updateBenchmarkTable(vitals) {
            const benchmarks = [
                { key: 'LCP', suffix: 'ms' },
                { key: 'FID', suffix: 'ms' },
                { key: 'CLS', suffix: '' },
                { key: 'TTFB', suffix: 'ms' }
            ];

            benchmarks.forEach(benchmark => {
                const value = vitals[benchmark.key];
                if (value !== undefined) {
                    const currentValue = document.getElementById(`${benchmark.key.toLowerCase()}Current`);
                    const statusElement = document.getElementById(`${benchmark.key.toLowerCase()}Status`);

                    if (currentValue) {
                        currentValue.textContent = `${Math.round(value)}${benchmark.suffix}`;
                    }

                    if (statusElement) {
                        const threshold = performanceMonitor ? performanceMonitor.thresholds[benchmark.key] : 1000;
                        const status = getMetricStatus(value, threshold);
                        statusElement.textContent = getStatusIcon(status);
                    }
                }
            });
        }

        /**
         * å‰µå»ºæŒ‡æ¨™å¡ç‰‡
         */
        function createMetricCard(label, value, unit, status) {
            const card = safeCreateElement('div', '', `metric-card ${status}`);

            const valueContainer = safeCreateElement('div', '', 'metric-value');
            valueContainer.textContent = `${Math.round(value)}`;

            if (unit) {
                const unitSpan = safeCreateElement('span', unit, 'metric-unit');
                valueContainer.appendChild(unitSpan);
            }

            card.appendChild(valueContainer);

            const labelDiv = safeCreateElement('div', label, 'metric-label');
            card.appendChild(labelDiv);

            return card;
        }

        /**
         * ç²å–æŒ‡æ¨™ç‹€æ…‹
         */
        function getMetricStatus(value, threshold) {
            if (value <= threshold) return 'good';
            if (value <= threshold * 2) return 'needs-improvement';
            return 'poor';
        }

        /**
         * ç²å–ç‹€æ…‹åœ–æ¨™
         */
        function getStatusIcon(status) {
            switch (status) {
                case 'good': return 'âœ… è‰¯å¥½';
                case 'needs-improvement': return 'âš ï¸ éœ€æ”¹é€²';
                case 'poor': return 'âŒ å·®';
                default: return 'â“ æœªçŸ¥';
            }
        }

        /**
         * ç²å–è¨˜æ†¶é«”é¡è‰²
         */
        function getMemoryColor(usage) {
            if (usage < 0.5) return '#4CAF50';
            if (usage < 0.8) return '#FF9800';
            return '#f44336';
        }

        /**
         * æ ¼å¼åŒ–ä½å…ƒçµ„
         */
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        /**
         * æª¢æŸ¥å„ªåŒ–ç‹€æ…‹
         */
        function checkOptimizationsStatus() {
            safeClearElement(optimizationsStatus);

            const status = performanceOptimizer ? performanceOptimizer.getEnabledOptimizations() : [];

            if (status.length === 0) {
                optimizationsStatus.appendChild(safeCreateElement('p', 'å°šæœªæ‡‰ç”¨ä»»ä½•æ€§èƒ½å„ªåŒ–'));
            } else {
                const container = safeCreateElement('div');
                container.style.display = 'flex';
                container.style.flexWrap = 'wrap';
                container.style.gap = '10px';

                status.forEach(opt => {
                    const span = safeCreateElement('span', `âœ… ${getOptimizationDisplayName(opt)}`);
                    span.style.background = '#28a745';
                    span.style.color = 'white';
                    span.style.padding = '5px 10px';
                    span.style.borderRadius = '15px';
                    span.style.fontSize = '14px';
                    container.appendChild(span);
                });

                optimizationsStatus.appendChild(container);
            }
        }

        /**
         * ç²å–å„ªåŒ–é¡¯ç¤ºåç¨±
         */
        function getOptimizationDisplayName(opt) {
            const names = {
                'lazy-loading': 'æ‡¶åŠ è¼‰',
                'code-splitting': 'ä»£ç¢¼åˆ†å‰²',
                'image-optimization': 'åœ–ç‰‡å„ªåŒ–',
                'preloading': 'è³‡æºé è¼‰å…¥',
                'service-worker': 'Service Worker',
                'resource-caching': 'è³‡æºå¿«å–'
            };
            return names[opt] || opt;
        }

        /**
         * é¡¯ç¤ºå„ªåŒ–æˆåŠŸè¨Šæ¯
         */
        function showOptimizationsSuccess(optimizations) {
            showSuccess(`å·²æ‡‰ç”¨ ${optimizations.length} é …æ€§èƒ½å„ªåŒ–ï¼š${optimizations.join(', ')}`);
        }

        /**
         * é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
         */
        function showLoading(show) {
            loadingIndicator.style.display = show ? 'block' : 'none';
            progressContainer.style.display = show ? 'block' : 'none';

            // ç¦ç”¨æ‰€æœ‰æŒ‰éˆ•
            document.querySelectorAll('.test-button').forEach(btn => {
                btn.disabled = show;
            });
        }

        /**
         * éš±è—è¼‰å…¥ç‹€æ…‹
         */
        function hideLoading() {
            showLoading(false);
        }

        /**
         * æ›´æ–°é€²åº¦
         */
        function updateProgress(percent, text) {
            progressFill.style.width = `${percent}%`;
            progressText.textContent = text || `${percent}%`;
        }

        /**
         * é¡¯ç¤ºæˆåŠŸè¨Šæ¯
         */
        function showSuccess(message) {
            console.log('âœ…', message);
            alert(message); // ç°¡åŒ–å¯¦ç¾
        }

        /**
         * é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
         */
        function showError(message) {
            console.error('âŒ', message);
            alert(message); // ç°¡åŒ–å¯¦ç¾
        }

        /**
         * é‹è¡Œ Lighthouseï¼ˆå¦‚æœå¯ç”¨ï¼‰
         */
        async function runLighthouse() {
            // é€™è£¡å¯ä»¥é›†æˆå¯¦éš›çš„ Lighthouse API
            // ç›®å‰è¿”å›æ¨¡æ“¬æ•¸æ“š
            throw new Error('Lighthouse API ä¸å¯ç”¨');
        }

        /**
         * é¡¯ç¤º Lighthouse çµæœ
         */
        function displayLighthouseResults(report) {
            console.log('Lighthouse å ±å‘Š:', report);
        }
    </script>
</body>
</html>