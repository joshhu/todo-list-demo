/**
 * ÊÄßËÉΩÁõ£ÊéßÂíåÂÑ™ÂåñÊ®°ÁµÑ
 * Êèê‰æõÊÄßËÉΩÊ∏¨Èáè„ÄÅÂÑ™ÂåñÂª∫Ë≠∞ÂíåÁõ£ÊéßÂäüËÉΩ
 */

/**
 * ÊÄßËÉΩÁõ£ÊéßÈ°ûÂà•
 */
class PerformanceMonitor {
    constructor() {
        this.metrics = {
            navigation: null,
            resources: [],
            paint: null,
            memory: null,
            vitals: {}
        };

        this.observers = {
            performance: null,
            vitals: null,
            memory: null
        };

        this.thresholds = {
            FCP: 1800,        // First Contentful Paint (ms)
            LCP: 2500,        // Largest Contentful Paint (ms)
            FID: 100,         // First Input Delay (ms)
            CLS: 0.1,         // Cumulative Layout Shift
            TTFB: 800,        // Time to First Byte (ms)
            loadTime: 3000    // È†ÅÈù¢ËºâÂÖ•ÊôÇÈñì (ms)
        };

        this.init();
    }

    /**
     * ÂàùÂßãÂåñÊÄßËÉΩÁõ£Êéß
     */
    init() {
        if ('performance' in window) {
            this.collectNavigationMetrics();
            this.observePerformance();
            this.observeVitals();
            this.observeMemory();
        }
    }

    /**
     * Êî∂ÈõÜÂ∞éËà™ÊåáÊ®ô
     */
    collectNavigationMetrics() {
        if ('getEntriesByType' in performance) {
            const navigationEntries = performance.getEntriesByType('navigation');
            if (navigationEntries.length > 0) {
                this.metrics.navigation = navigationEntries[0];
            }
        }
    }

    /**
     * ËßÄÂØüË≥áÊ∫êËºâÂÖ•
     */
    observePerformance() {
        if ('PerformanceObserver' in window) {
            try {
                // ËßÄÂØüË≥áÊ∫êËºâÂÖ•
                const resourceObserver = new PerformanceObserver((list) => {
                    list.getEntries().forEach(entry => {
                        this.metrics.resources.push(entry);
                    });
                });
                resourceObserver.observe({ entryTypes: ['resource'] });
                this.observers.performance = resourceObserver;
            } catch (e) {
                console.warn('Resource performance observer not supported:', e);
            }
        }
    }

    /**
     * ËßÄÂØüÊ†∏ÂøÉ Web ÊåáÊ®ô
     */
    observeVitals() {
        // First Contentful Paint
        this.observePaint();

        // Largest Contentful Paint
        this.observeLCP();

        // First Input Delay
        this.observeFID();

        // Cumulative Layout Shift
        this.observeCLS();
    }

    /**
     * ËßÄÂØüÁπ™Ë£ΩÊåáÊ®ô
     */
    observePaint() {
        if ('PerformanceObserver' in window) {
            try {
                const paintObserver = new PerformanceObserver((list) => {
                    list.getEntries().forEach(entry => {
                        if (!this.metrics.paint) {
                            this.metrics.paint = {};
                        }
                        this.metrics.paint[entry.name] = entry.startTime;
                    });
                });
                paintObserver.observe({ entryTypes: ['paint'] });
            } catch (e) {
                console.warn('Paint performance observer not supported:', e);
            }
        }
    }

    /**
     * ËßÄÂØüÊúÄÂ§ßÂÖßÂÆπÁπ™Ë£Ω
     */
    observeLCP() {
        if ('PerformanceObserver' in window) {
            try {
                const lcpObserver = new PerformanceObserver((list) => {
                    const entries = list.getEntries();
                    const lastEntry = entries[entries.length - 1];
                    this.metrics.vitals.LCP = Math.round(lastEntry.startTime);
                    this.checkVitalThreshold('LCP', this.metrics.vitals.LCP);
                });
                lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] });
            } catch (e) {
                console.warn('LCP observer not supported:', e);
            }
        }
    }

    /**
     * ËßÄÂØüÈ¶ñÊ¨°Ëº∏ÂÖ•Âª∂ÈÅ≤
     */
    observeFID() {
        if ('PerformanceObserver' in window) {
            try {
                const fidObserver = new PerformanceObserver((list) => {
                    list.getEntries().forEach(entry => {
                        if (entry.processingStart && entry.startTime) {
                            this.metrics.vitals.FID = Math.round(entry.processingStart - entry.startTime);
                            this.checkVitalThreshold('FID', this.metrics.vitals.FID);
                        }
                    });
                });
                fidObserver.observe({ entryTypes: ['first-input'] });
            } catch (e) {
                console.warn('FID observer not supported:', e);
            }
        }
    }

    /**
     * ËßÄÂØüÁ¥ØË®à‰ΩàÂ±ÄÂÅèÁßª
     */
    observeCLS() {
        if ('PerformanceObserver' in window) {
            try {
                let clsValue = 0;
                const clsObserver = new PerformanceObserver((list) => {
                    list.getEntries().forEach(entry => {
                        if (!entry.hadRecentInput) {
                            clsValue += entry.value;
                        }
                    });
                    this.metrics.vitals.CLS = Math.round(clsValue * 1000) / 1000;
                    this.checkVitalThreshold('CLS', this.metrics.vitals.CLS);
                });
                clsObserver.observe({ entryTypes: ['layout-shift'] });
            } catch (e) {
                console.warn('CLS observer not supported:', e);
            }
        }
    }

    /**
     * ËßÄÂØüË®òÊÜ∂È´î‰ΩøÁî®
     */
    observeMemory() {
        if ('memory' in performance) {
            // ÂÆöÊúüÊî∂ÈõÜË®òÊÜ∂È´îË≥áË®ä
            setInterval(() => {
                this.metrics.memory = {
                    used: performance.memory.usedJSHeapSize,
                    total: performance.memory.totalJSHeapSize,
                    limit: performance.memory.jsHeapSizeLimit,
                    timestamp: Date.now()
                };
            }, 5000); // ÊØè 5 ÁßíÊî∂ÈõÜ‰∏ÄÊ¨°
        }
    }

    /**
     * Ê™¢Êü•ÊåáÊ®ôÈñæÂÄº
     */
    checkVitalThreshold(vital, value) {
        const threshold = this.thresholds[vital];
        if (threshold) {
            const status = value <= threshold ? 'good' : 'needs-improvement';
            console.log(`üîç ${vital}: ${value}ms (${status})`);

            if (status === 'needs-improvement') {
                this.generateOptimizationSuggestion(vital, value);
            }
        }
    }

    /**
     * ÁîüÊàêÂÑ™ÂåñÂª∫Ë≠∞
     */
    generateOptimizationSuggestion(vital, value) {
        const suggestions = {
            LCP: {
                issue: 'ÊúÄÂ§ßÂÖßÂÆπÁπ™Ë£ΩÊôÇÈñìÈÅéÈï∑',
                solutions: [
                    'ÂÑ™ÂåñÂúñÁâáËºâÂÖ•Ôºà‰ΩøÁî® WebP Ê†ºÂºè„ÄÅÂ£ìÁ∏ÆÂúñÁâáÔºâ',
                    'ÂØ¶ÁèæÊá∂Âä†ËºâÊ©üÂà∂',
                    'ÂÑ™Âåñ‰º∫ÊúçÂô®ÈüøÊáâÊôÇÈñì',
                    '‰ΩøÁî® CDN Âä†ÈÄüË≥áÊ∫êËºâÂÖ•'
                ]
            },
            FID: {
                issue: 'È¶ñÊ¨°Ëº∏ÂÖ•Âª∂ÈÅ≤ÈÅéÈï∑',
                solutions: [
                    'Ê∏õÂ∞ë JavaScript Âü∑Ë°åÊôÇÈñì',
                    'ÂàÜÂâ≤‰ª£Á¢ºÔºåÂØ¶ÁèæÊåâÈúÄËºâÂÖ•',
                    'ÂÑ™ÂåñÁ¨¨‰∏âÊñπËÖ≥Êú¨ËºâÂÖ•',
                    '‰ΩøÁî® Web Workers ËôïÁêÜÈï∑ÊôÇÈñì‰ªªÂãô'
                ]
            },
            CLS: {
                issue: 'Á¥ØË®à‰ΩàÂ±ÄÂÅèÁßªÈÅéÂ§ß',
                solutions: [
                    'ÁÇ∫ÂúñÁâáÂíåÂª£ÂëäÊåáÂÆöÂ∞∫ÂØ∏',
                    'È†êÁïôÂãïÊÖãÂÖßÂÆπÁ©∫Èñì',
                    'ÈÅøÂÖçÊèíÂÖ•ÂÖßÂÆπÂà∞ÁèæÊúâÂÖßÂÆπ‰∏äÊñπ',
                    '‰ΩøÁî® transform ÂãïÁï´ËÄåÈùûÊîπËÆä‰ΩàÂ±ÄÂ±¨ÊÄß'
                ]
            }
        };

        const suggestion = suggestions[vital];
        if (suggestion) {
            console.warn(`‚ö†Ô∏è ${suggestion.issue}: ${value}`);
            console.log('üí° Âª∫Ë≠∞Ëß£Ê±∫ÊñπÊ°à:');
            suggestion.solutions.forEach((sol, index) => {
                console.log(`   ${index + 1}. ${sol}`);
            });
        }
    }

    /**
     * Áç≤ÂèñÊÄßËÉΩÂ†±Âëä
     */
    getPerformanceReport() {
        const report = {
            timestamp: new Date().toISOString(),
            vitals: this.metrics.vitals,
            navigation: this.getNavigationMetrics(),
            resources: this.getResourceMetrics(),
            memory: this.metrics.memory,
            score: this.calculatePerformanceScore(),
            recommendations: this.getRecommendations()
        };

        return report;
    }

    /**
     * Áç≤ÂèñÂ∞éËà™ÊåáÊ®ô
     */
    getNavigationMetrics() {
        if (!this.metrics.navigation) return null;

        const nav = this.metrics.navigation;
        return {
            dns: nav.domainLookupEnd - nav.domainLookupStart,
            tcp: nav.connectEnd - nav.connectStart,
            ssl: nav.secureConnectionStart > 0 ? nav.connectEnd - nav.secureConnectionStart : 0,
            ttfb: nav.responseStart - nav.requestStart,
            download: nav.responseEnd - nav.responseStart,
            domParse: nav.domContentLoadedEventStart - nav.responseEnd,
            domReady: nav.domContentLoadedEventEnd - nav.domContentLoadedEventStart,
            loadComplete: nav.loadEventEnd - nav.loadEventStart,
            totalTime: nav.loadEventEnd - nav.navigationStart
        };
    }

    /**
     * Áç≤ÂèñË≥áÊ∫êÊåáÊ®ô
     */
    getResourceMetrics() {
        const resources = this.metrics.resources;
        const byType = {};

        resources.forEach(resource => {
            const type = resource.initiatorType || 'other';
            if (!byType[type]) {
                byType[type] = {
                    count: 0,
                    totalSize: 0,
                    totalTime: 0
                };
            }

            byType[type].count++;
            if (resource.transferSize) {
                byType[type].totalSize += resource.transferSize;
            }
            byType[type].totalTime += resource.duration;
        });

        return byType;
    }

    /**
     * Ë®àÁÆóÊÄßËÉΩÂàÜÊï∏
     */
    calculatePerformanceScore() {
        const vitals = this.metrics.vitals;
        let score = 100;
        let penalties = 0;

        // LCP Ê¨äÈáç: 25%
        if (vitals.LCP) {
            if (vitals.LCP > this.thresholds.LCP * 2) {
                penalties += 25;
            } else if (vitals.LCP > this.thresholds.LCP) {
                penalties += 15;
            }
        }

        // FID Ê¨äÈáç: 30%
        if (vitals.FID) {
            if (vitals.FID > this.thresholds.FID * 3) {
                penalties += 30;
            } else if (vitals.FID > this.thresholds.FID) {
                penalties += 15;
            }
        }

        // CLS Ê¨äÈáç: 25%
        if (vitals.CLS) {
            if (vitals.CLS > this.thresholds.CLS * 2) {
                penalties += 25;
            } else if (vitals.CLS > this.thresholds.CLS) {
                penalties += 10;
            }
        }

        // TTFB Ê¨äÈáç: 20%
        const ttfb = this.getNavigationMetrics()?.ttfb;
        if (ttfb) {
            if (ttfb > this.thresholds.TTFB * 2) {
                penalties += 20;
            } else if (ttfb > this.thresholds.TTFB) {
                penalties += 10;
            }
        }

        return Math.max(0, score - penalties);
    }

    /**
     * Áç≤ÂèñÂÑ™ÂåñÂª∫Ë≠∞
     */
    getRecommendations() {
        const recommendations = [];
        const vitals = this.metrics.vitals;
        const navigation = this.getNavigationMetrics();

        // LCP Âª∫Ë≠∞
        if (vitals.LCP && vitals.LCP > this.thresholds.LCP) {
            recommendations.push({
                metric: 'LCP',
                priority: 'high',
                title: 'ÂÑ™ÂåñÊúÄÂ§ßÂÖßÂÆπÁπ™Ë£ΩÊôÇÈñì',
                description: `Áï∂Ââç LCP ÁÇ∫ ${vitals.LCP}msÔºåÂª∫Ë≠∞ÂÑ™ÂåñÂà∞ ${this.thresholds.LCP}ms ‰ª•‰∏ã`,
                actions: [
                    '‰ΩøÁî®Áèæ‰ª£ÂúñÁâáÊ†ºÂºèÔºàWebP„ÄÅAVIFÔºâ',
                    'ÂØ¶ÁèæÂúñÁâáÊá∂Âä†Ëºâ',
                    'ÂÑ™Âåñ‰º∫ÊúçÂô®ÈüøÊáâÊôÇÈñì',
                    'Ê∏õÂ∞ëÈòªÁ§ôÊ∏≤ÊüìÁöÑË≥áÊ∫ê'
                ]
            });
        }

        // FID Âª∫Ë≠∞
        if (vitals.FID && vitals.FID > this.thresholds.FID) {
            recommendations.push({
                metric: 'FID',
                priority: 'high',
                title: 'Ê∏õÂ∞ëÈ¶ñÊ¨°Ëº∏ÂÖ•Âª∂ÈÅ≤',
                description: `Áï∂Ââç FID ÁÇ∫ ${vitals.FID}msÔºåÂª∫Ë≠∞ÂÑ™ÂåñÂà∞ ${this.thresholds.FID}ms ‰ª•‰∏ã`,
                actions: [
                    'ÂàÜÂâ≤ JavaScript ‰ª£Á¢º',
                    'Âª∂ÈÅ≤ËºâÂÖ•ÈùûÈóúÈçµËÖ≥Êú¨',
                    '‰ΩøÁî® Web Workers ËôïÁêÜË§áÈõúË®àÁÆó',
                    'Ê∏õÂ∞ë‰∏ªÂü∑Ë°åÁ∑íÂ∑•‰Ωú'
                ]
            });
        }

        // CLS Âª∫Ë≠∞
        if (vitals.CLS && vitals.CLS > this.thresholds.CLS) {
            recommendations.push({
                metric: 'CLS',
                priority: 'medium',
                title: 'Ê∏õÂ∞ë‰ΩàÂ±ÄÂÅèÁßª',
                description: `Áï∂Ââç CLS ÁÇ∫ ${vitals.CLS}ÔºåÂª∫Ë≠∞ÂÑ™ÂåñÂà∞ ${this.thresholds.CLS} ‰ª•‰∏ã`,
                actions: [
                    'ÁÇ∫ÂúñÁâáÂíåÂΩ±ÁâáË®≠ÂÆöÂ∞∫ÂØ∏',
                    'ÈÅøÂÖçÂú®ÁèæÊúâÂÖßÂÆπ‰∏äÊñπÊèíÂÖ•ÂÖßÂÆπ',
                    '‰ΩøÁî® CSS transform ÂãïÁï´',
                    'Á¢∫‰øùÂ≠óÈ´îËºâÂÖ•‰∏çÈÄ†Êàê‰ΩàÂ±ÄËÆäÂåñ'
                ]
            });
        }

        // TTFB Âª∫Ë≠∞
        if (navigation && navigation.ttfb > this.thresholds.TTFB) {
            recommendations.push({
                metric: 'TTFB',
                priority: 'high',
                title: 'ÂÑ™Âåñ‰º∫ÊúçÂô®ÈüøÊáâÊôÇÈñì',
                description: `Áï∂Ââç TTFB ÁÇ∫ ${navigation.ttfb}msÔºåÂª∫Ë≠∞ÂÑ™ÂåñÂà∞ ${this.thresholds.TTFB}ms ‰ª•‰∏ã`,
                actions: [
                    '‰ΩøÁî® CDN Âä†ÈÄüÈùúÊÖãË≥áÊ∫ê',
                    'ÂïüÁî® Gzip Â£ìÁ∏Æ',
                    'ÂÑ™ÂåñË≥áÊñôÂ∫´Êü•Ë©¢',
                    '‰ΩøÁî®Âø´ÂèñÊ©üÂà∂'
                ]
            });
        }

        return recommendations;
    }

    /**
     * ÈñãÂßãÊÄßËÉΩÊ∏¨Ë©¶
     */
    startPerformanceTest() {
        console.log('üöÄ ÈñãÂßãÊÄßËÉΩÁõ£Êéß...');
        this.startTestTime = performance.now();
    }

    /**
     * ÁµêÊùüÊÄßËÉΩÊ∏¨Ë©¶‰∏¶È°ØÁ§∫Â†±Âëä
     */
    endPerformanceTest() {
        if (!this.startTestTime) return;

        const testDuration = performance.now() - this.startTestTime;
        const report = this.getPerformanceReport();

        console.log('üìä ÊÄßËÉΩÊ∏¨Ë©¶Â†±Âëä:');
        console.log(`Ê∏¨Ë©¶ÊåÅÁ∫åÊôÇÈñì: ${Math.round(testDuration)}ms`);
        console.log(`ÊÄßËÉΩÂàÜÊï∏: ${report.score}/100`);

        if (report.vitals) {
            console.log('Ê†∏ÂøÉ Web ÊåáÊ®ô:');
            Object.entries(report.vitals).forEach(([key, value]) => {
                const threshold = this.thresholds[key];
                const status = threshold ? (value <= threshold ? '‚úÖ' : '‚ö†Ô∏è') : '‚ÑπÔ∏è';
                console.log(`  ${key}: ${value}${key === 'CLS' ? '' : 'ms'} ${status}`);
            });
        }

        if (report.recommendations.length > 0) {
            console.log('\nüí° ÂÑ™ÂåñÂª∫Ë≠∞:');
            report.recommendations.forEach((rec, index) => {
                console.log(`\n${index + 1}. ${rec.title} (${rec.priority})`);
                console.log(`   ${rec.description}`);
                rec.actions.forEach(action => {
                    console.log(`   ‚Ä¢ ${action}`);
                });
            });
        }

        return report;
    }

    /**
     * Ê∏ÖÁêÜÁõ£ÊéßÂô®
     */
    cleanup() {
        Object.values(this.observers).forEach(observer => {
            if (observer && observer.disconnect) {
                observer.disconnect();
            }
        });
    }
}

/**
 * ÊÄßËÉΩÂÑ™ÂåñÂ∑•ÂÖ∑È°ûÂà•
 */
class PerformanceOptimizer {
    constructor() {
        this.optimizations = [];
    }

    /**
     * ÂØ¶ÁèæÂúñÁâáÊá∂Âä†Ëºâ
     */
    setupLazyLoading() {
        if ('IntersectionObserver' in window) {
            const imageObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        if (img.dataset.src) {
                            img.src = img.dataset.src;
                            img.removeAttribute('data-src');
                            img.classList.remove('lazy');
                            imageObserver.unobserve(img);
                        }
                    }
                });
            }, {
                rootMargin: '50px 0px',
                threshold: 0.1
            });

            // ËßÄÂØüÊâÄÊúâÊá∂Âä†ËºâÂúñÁâá
            document.querySelectorAll('img[data-src]').forEach(img => {
                imageObserver.observe(img);
            });

            this.optimizations.push('lazy-loading');
            console.log('‚úÖ ÂúñÁâáÊá∂Âä†ËºâÂ∑≤ÂïüÁî®');
        } else {
            console.warn('‚ö†Ô∏è ÁÄèË¶ΩÂô®‰∏çÊîØÊè¥ IntersectionObserver');
        }
    }

    /**
     * Ë®≠ÁΩÆÁ®ãÂºèÁ¢ºÂàÜÂâ≤
     */
    setupCodeSplitting() {
        // ÂãïÊÖãËºâÂÖ•ÈùûÈóúÈçµÊ®°ÁµÑ
        const loadModule = async (moduleName, element) => {
            try {
                const module = await import(`./modules/${moduleName}.js`);
                if (module.default && typeof module.default.init === 'function') {
                    module.default.init(element);
                }
            } catch (error) {
                console.error(`ËºâÂÖ•Ê®°ÁµÑ ${moduleName} Â§±Êïó:`, error);
            }
        };

        // Â∞ãÊâæÈúÄË¶ÅÂãïÊÖãËºâÂÖ•ÁöÑÂÖÉÁ¥†
        document.querySelectorAll('[data-module]').forEach(element => {
            const moduleName = element.dataset.module;
            if (element.getBoundingClientRect().top < window.innerHeight + 200) {
                // Á´ãÂç≥ËºâÂÖ•ÂèØË¶ãÁöÑÊ®°ÁµÑ
                loadModule(moduleName, element);
            } else {
                // Êá∂Âä†Ëºâ‰∏çÂèØË¶ãÁöÑÊ®°ÁµÑ
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            loadModule(moduleName, entry.target);
                            observer.unobserve(entry.target);
                        }
                    });
                });
                observer.observe(element);
            }
        });

        this.optimizations.push('code-splitting');
        console.log('‚úÖ Á®ãÂºèÁ¢ºÂàÜÂâ≤Â∑≤ÂïüÁî®');
    }

    /**
     * ÂÑ™ÂåñÂúñÁâáËºâÂÖ•
     */
    optimizeImages() {
        // ËΩâÊèõÁÇ∫ WebP Ê†ºÂºèÔºàÂ¶ÇÊûúÊîØÊè¥Ôºâ
        if (this.supportsWebP()) {
            document.querySelectorAll('img[data-webp]').forEach(img => {
                if (img.dataset.webp) {
                    img.src = img.dataset.webp;
                    img.removeAttribute('data-webp');
                }
            });
        }

        // Ê∑ªÂä†ËºâÂÖ•ÈåØË™§ËôïÁêÜ
        document.querySelectorAll('img').forEach(img => {
            img.addEventListener('error', function() {
                if (!this.classList.contains('error')) {
                    this.classList.add('error');
                    this.src = 'assets/images/placeholder.png';
                }
            });
        });

        this.optimizations.push('image-optimization');
        console.log('‚úÖ ÂúñÁâáÂÑ™ÂåñÂ∑≤ÂïüÁî®');
    }

    /**
     * Ê™¢Êü• WebP ÊîØÊè¥
     */
    supportsWebP() {
        return new Promise(resolve => {
            const webP = new Image();
            webP.onload = webP.onerror = function() {
                resolve(webP.height === 2);
            };
            webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';
        });
    }

    /**
     * Ë®≠ÁΩÆË≥áÊ∫êÈ†êËºâÂÖ•
     */
    setupPreloading() {
        const criticalResources = [
            { href: 'css/main.css', as: 'style' },
            { href: 'js/main.js', as: 'script' },
            { href: 'fonts/main.woff2', as: 'font', type: 'font/woff2', crossorigin: true }
        ];

        criticalResources.forEach(resource => {
            const link = document.createElement('link');
            link.rel = 'preload';
            link.href = resource.href;
            link.as = resource.as;

            if (resource.type) {
                link.type = resource.type;
            }

            if (resource.crossorigin) {
                link.crossOrigin = 'anonymous';
            }

            document.head.appendChild(link);
        });

        this.optimizations.push('preloading');
        console.log('‚úÖ Ë≥áÊ∫êÈ†êËºâÂÖ•Â∑≤ÂïüÁî®');
    }

    /**
     * Ë®≠ÁΩÆÂø´ÂèñÁ≠ñÁï•
     */
    setupCaching() {
        if ('caches' in window) {
            // Ë®ªÂÜä Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker Ë®ªÂÜäÊàêÂäü:', registration);
                        this.optimizations.push('service-worker');
                    })
                    .catch(error => {
                        console.error('‚ùå Service Worker Ë®ªÂÜäÂ§±Êïó:', error);
                    });
            }

            // Ë®≠ÁΩÆË≥áÊ∫êÂø´Âèñ
            this.cacheResources();
        } else {
            console.warn('‚ö†Ô∏è ÁÄèË¶ΩÂô®‰∏çÊîØÊè¥ Cache API');
        }
    }

    /**
     * Âø´ÂèñÈóúÈçµË≥áÊ∫ê
     */
    async cacheResources() {
        const resourcesToCache = [
            '/',
            '/index.html',
            '/css/main.css',
            '/js/main.js',
            '/assets/icons/favicon.ico'
        ];

        try {
            const cache = await caches.open('todo-app-v1');
            await cache.addAll(resourcesToCache);
            console.log('‚úÖ ÈóúÈçµË≥áÊ∫êÂ∑≤Âø´Âèñ');
            this.optimizations.push('resource-caching');
        } catch (error) {
            console.error('‚ùå Ë≥áÊ∫êÂø´ÂèñÂ§±Êïó:', error);
        }
    }

    /**
     * Áç≤ÂèñÂ∑≤ÂïüÁî®ÁöÑÂÑ™Âåñ
     */
    getEnabledOptimizations() {
        return this.optimizations;
    }

    /**
     * ÊáâÁî®ÊâÄÊúâÂÑ™Âåñ
     */
    async applyAllOptimizations() {
        console.log('üöÄ ÈñãÂßãÊáâÁî®ÊÄßËÉΩÂÑ™Âåñ...');

        this.setupLazyLoading();
        this.setupCodeSplitting();
        await this.optimizeImages();
        this.setupPreloading();
        this.setupCaching();

        console.log('‚úÖ ÊâÄÊúâÊÄßËÉΩÂÑ™ÂåñÂ∑≤ÂÆåÊàê');
        console.log('Â∑≤ÂïüÁî®ÁöÑÂÑ™Âåñ:', this.optimizations.join(', '));

        return this.optimizations;
    }
}

// Â∞éÂá∫Ê®°ÁµÑ
export { PerformanceMonitor, PerformanceOptimizer };

// ÂÖ®ÂüüÂàùÂßãÂåñ
window.PerformanceMonitor = PerformanceMonitor;
window.PerformanceOptimizer = PerformanceOptimizer;